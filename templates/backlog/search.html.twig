{% extends 'base.html.twig' %}

{% block title %}Search Results for "{{ query }}"{% endblock %}

{% block body %}
  <h1>Search results for "{{ query }}"</h1>

  <div class="results">
    {% for item in results %}
      <div class="result">
        {% if item.image %}
          <img src="{{ item.image }}" alt="{{ item.name }}" width="150">
        {% endif %}

        <h3>{{ item.name }}</h3>

        {% if item.type == 'artist' %}
          {# <p><strong>Type:</strong> Artist</p> #}
        {% elseif item.type == 'album' %}
          {# <p><strong>Type:</strong> Album</p> #}
          <p><strong>Artist:</strong> {{ item.artist_display }}</p>
          <p><strong>Released:</strong> {{ item.release_date }}</p>
        {% endif %}
      </div>

      <form action="{{ path('app_backlog_additem') }}" method="post">
        <input type="hidden" name="type" value="{{ item.type }}">
        <input type="hidden" name="name" value="{{ item.name }}">
        <input type="hidden" name="spotify_id" value="{{ item.spotify_id }}">
        <input type="hidden" name="image" value="{{ item.image }}">
        {% if item.type == 'album' %}
          <input type="hidden" name="release_date" value="{{ item.release_date }}">
          <input type="hidden" name="artists" value="{{ item.artists|json_encode() }}">
        {% endif %}

        <label for="backlog-select-{{ loop.index }}">Add to backlog:</label>
        <select id="backlog-select-{{ loop.index }}" name="backlog_uuid" required>
          {% for backlog in backlogs %}
            <option value="{{ backlog.uuid }}">{{ backlog.name }}</option>
          {% endfor %}
        </select>
        <button type="submit">Add to Backlog</button>
      </form>
    {% else %}
      <p>No results found.</p>
    {% endfor %}
  </div>

  <a href="{{ path('app_backlog_index') }}">Back to Backlog</a>
{% endblock %}
